<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Analytics Dashboard</title>
<link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<style>
body { font-family:'Roboto',sans-serif; background: linear-gradient(120deg,#f0f3ff,#fff4f4); min-height:100vh; padding:20px;}
.glass-card { background: rgba(255,255,255,0.15); backdrop-filter: blur(14px); border-radius: 18px; box-shadow: 0 8px 28px rgba(0,0,0,0.1); border: 1px solid rgba(255,255,255,0.2); padding: 20px; margin-bottom: 20px; transition: all 0.3s ease;}
.glass-card:hover { transform: translateY(-4px); box-shadow:0 12px 30px rgba(0,0,0,0.2);}
.chart-container { position: relative; width: 100%; max-width: 700px; margin:auto;}
.stats-grid { display:grid; grid-template-columns: repeat(auto-fit,minmax(200px,1fr)); gap:15px;}
.stat-card { background: rgba(255,255,255,0.2); border-radius: 14px; padding:15px; text-align:center; backdrop-filter:blur(10px); transition:0.3s;}
.stat-card:hover { background: rgba(255,255,255,0.35); transform: translateY(-2px);}
.stat-number { font-size:1.8rem; font-weight:700; color:#333;}
.stat-label { color:#555; font-weight:500; margin-top:5px; display:block; }
</style>
</head>
<body>

<h1 class="text-2xl font-bold mb-6 text-gray-900 text-center">ðŸ“Š Analytics Dashboard</h1>

<div class="stats-grid mb-8">
  <div class="stat-card glass-card">
    <span class="stat-number" id="totalVisits">0</span>
    <span class="stat-label">Total Visits</span>
  </div>
  <div class="stat-card glass-card">
    <span class="stat-number" id="totalClicks">0</span>
    <span class="stat-label">Total Clicks</span>
  </div>
  <div class="stat-card glass-card">
    <span class="stat-number" id="mostViewed">0</span>
    <span class="stat-label">Most Viewed Post</span>
  </div>
  <div class="stat-card glass-card">
    <span class="stat-number" id="topCategory">0</span>
    <span class="stat-label">Top Category</span>
  </div>
</div>

<div class="chart-container glass-card mb-6">
  <canvas id="viewsChart"></canvas>
</div>

<div class="chart-container glass-card mb-6">
  <canvas id="clicksChart"></canvas>
</div>

<script>
const API_BASE = "https://jesse-network.site/wp-json/wp/v2/";
const token = localStorage.getItem("token"); // your auth token
const AUTH_HEADERS = token? { "Authorization": "Bearer " + token } : {};

async function fetchPosts() {
  try {
    const res = await fetch(`${API_BASE}posts?per_page=100`, { headers: AUTH_HEADERS });
    return await res.json();
  } catch(err){ console.error(err); return []; }
}

async function fetchCategories() {
  try {
    const res = await fetch(`${API_BASE}categories?per_page=100`, { headers: AUTH_HEADERS });
    return await res.json();
  } catch(err){ console.error(err); return []; }
}

function animateNumber(id,value,duration=1000){
  const el = document.getElementById(id);
  let start = 0;
  const step = value/duration*20;
  const interval = setInterval(()=>{
    start+=step;
    if(start>=value){ start=value; clearInterval(interval);}
    el.textContent = Math.floor(start);
  },20);
}

async function renderAnalytics(){
  const posts = await fetchPosts();
  const categories = await fetchCategories();

  // ====== Total Visits ======
  let totalVisits = posts.reduce((sum,p)=>sum + (p.meta?.views || 0),0);
  animateNumber("totalVisits", totalVisits);

  // ====== Total Clicks ======
  let totalClicks = posts.reduce((sum,p)=>sum + (p.meta?.clicks || 0),0);
  animateNumber("totalClicks", totalClicks);

  // ====== Most Viewed Post ======
  let mostViewedPost = posts.sort((a,b)=> (b.meta?.views||0) - (a.meta?.views||0))[0];
  document.getElementById("mostViewed").textContent = mostViewedPost ? mostViewedPost.title.rendered : "N/A";

  // ====== Top Category ======
  const categoryViews = {};
  posts.forEach(p=>{
    p.categories.forEach(c=>{
      categoryViews[c] = (categoryViews[c] || 0) + (p.meta?.views||0);
    });
  });
  const topCatId = Object.keys(categoryViews).sort((a,b)=> categoryViews[b]-categoryViews[a])[0];
  const topCat = categories.find(c=>c.id==topCatId);
  document.getElementById("topCategory").textContent = topCat? topCat.name : "N/A";

  // ====== Charts ======
  const days = ["Mon","Tue","Wed","Thu","Fri","Sat","Sun"];
  const viewsOverTime = days.map((_,i)=> posts.reduce((sum,p)=> sum + ((p.meta?.views_by_day||[])[i]||0),0));
  const clicksOverTime = days.map((_,i)=> posts.reduce((sum,p)=> sum + ((p.meta?.clicks_by_day||[])[i]||0),0));

  const ctx1 = document.getElementById('viewsChart').getContext('2d');
  new Chart(ctx1,{
    type:'line',
    data:{ labels: days, datasets:[{ label:'Views', data: viewsOverTime, borderColor:'#6a5af9', backgroundColor:'rgba(106,90,249,0.2)', tension:0.3, fill:true, pointRadius:5 }]},
    options:{ responsive:true, plugins:{ legend:{display:true} }, scales:{ y:{ beginAtZero:true } } }
  });

  const ctx2 = document.getElementById('clicksChart').getContext('2d');
  new Chart(ctx2,{
    type:'bar',
    data:{ labels: days, datasets:[{ label:'Clicks', data: clicksOverTime, backgroundColor:'rgba(106,90,249,0.6)' }]},
    options:{ responsive:true, plugins:{ legend:{display:true} }, scales:{ y:{ beginAtZero:true } } }
  });
}

renderAnalytics();
</script>
</body>
</html>
